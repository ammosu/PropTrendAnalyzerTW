<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://code.jquery.com https://cdn.jsdelivr.net https://stackpath.bootstrapcdn.com;
        style-src 'self' 'unsafe-inline' https://stackpath.bootstrapcdn.com https://cdnjs.cloudflare.com https://fonts.googleapis.com;
        img-src 'self' data: blob: https:;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        connect-src 'self' https://stackpath.bootstrapcdn.com https://cdn.jsdelivr.net;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        worker-src 'self' blob:;
        upgrade-insecure-requests;">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="description" content="台灣房地產市場新聞趨勢分析工具，提供房市新聞摘要與市場預期走向分析">
    <title>房市新聞摘要與趨勢分析</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 專業儀表板字型配對: Poppins (標題) + Open Sans (內文) + Fira Code (數據) + Noto Sans TC (中文) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Fira+Code:wght@400;500;600&family=Noto+Sans+TC:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="style.css">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <!-- 跳過導航連結 -->
    <a href="#main-content" class="skip-to-main-content sr-only sr-only-focusable">跳到主要內容</a>

    <div class="container mt-4">
        <header role="banner">
            <!-- 深色模式切換按鈕 -->
            <div class="dark-mode-toggle-container">
                <button id="dark-mode-toggle" class="btn btn-sm btn-outline-secondary" aria-label="切換深色模式" title="切換深色模式">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                    <span class="dark-mode-text">深色模式</span>
                </button>
            </div>
            <h1 id="page-title" class="my-4 text-center animate__animated animate__fadeIn">房市新聞摘要與趨勢分析</h1>
            <p class="text-center text-muted mb-4 animate__animated animate__fadeIn animate__delay-1s">分析台灣房地產市場新聞，掌握最新趨勢與洞察</p>
        </header>
        
        <!-- 測試SVG圖片 -->
        <div class="text-center mb-3" id="svg-test" style="display:none;">
            <img src="data:image/svg+xml;charset=UTF-8,%3csvg width='200' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='%233498db'/%3e%3ctext x='50%25' y='50%25' font-family='Arial' font-size='14' fill='white' text-anchor='middle' dy='.3em'%3e測試圖片%3c/text%3e%3c/svg%3e" alt="測試SVG圖片" style="max-width: 200px;">
            <p><small>SVG 圖片測試</small></p>
        </div>
        
        <!-- CSV上傳浮動按鈕 -->
        <button id="upload-fab" class="upload-fab" aria-label="上傳CSV資料" title="上傳CSV資料">
            <i class="fas fa-cloud-upload-alt"></i>
        </button>

        <!-- 骨架屏 - 統計卡片 -->
        <section id="stats-skeleton" class="mb-4" style="display: none;">
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card-skeleton">
                        <div class="skeleton skeleton-icon"></div>
                        <div class="skeleton-content">
                            <div class="skeleton skeleton-value"></div>
                            <div class="skeleton skeleton-label"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card-skeleton">
                        <div class="skeleton skeleton-icon"></div>
                        <div class="skeleton-content">
                            <div class="skeleton skeleton-value"></div>
                            <div class="skeleton skeleton-label"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card-skeleton">
                        <div class="skeleton skeleton-icon"></div>
                        <div class="skeleton-content">
                            <div class="skeleton skeleton-value"></div>
                            <div class="skeleton skeleton-label"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card-skeleton">
                        <div class="skeleton skeleton-icon"></div>
                        <div class="skeleton-content">
                            <div class="skeleton skeleton-value"></div>
                            <div class="skeleton skeleton-label"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 資料統計摘要區塊 -->
        <section id="data-summary-section" class="mb-4 animate__animated animate__fadeIn data-dependent-section" style="display: none;">
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card stat-card-blue">
                        <div class="stat-icon">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-articles-count" data-target="0">0</div>
                            <div class="stat-label">篇文章</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card stat-card-green">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value small-text" id="date-range-display">-</div>
                            <div class="stat-label">資料範圍</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card stat-card-orange">
                        <div class="stat-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="keywords-count" data-target="0">0</div>
                            <div class="stat-label">個關鍵詞</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card stat-card-purple">
                        <div class="stat-icon">
                            <i class="fas fa-rss"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="publishers-count" data-target="0">0</div>
                            <div class="stat-label">家媒體</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 圖表預覽卡片區塊 -->
        <section id="chart-preview-section" class="mb-4 animate__animated animate__fadeIn data-dependent-section" style="display: none;">
            <h5 class="mb-3"><i class="fas fa-chart-area"></i> 數據總覽</h5>
            <div class="row">
                <!-- 關鍵詞趨勢預覽 -->
                <div class="col-md-4 mb-3">
                    <div class="chart-preview-card" role="button" tabindex="0" aria-label="查看關鍵詞趨勢分析詳情">
                        <div class="chart-preview-header">
                            <div class="chart-preview-icon chart-preview-icon-blue">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="chart-preview-title">
                                <h6>關鍵詞趨勢</h6>
                                <p class="chart-preview-subtitle">熱門關鍵詞出現頻率</p>
                            </div>
                        </div>
                        <div class="chart-preview-body">
                            <canvas id="mini-keyword-chart" width="300" height="150"></canvas>
                        </div>
                        <div class="chart-preview-footer">
                            <span class="chart-preview-link">查看完整分析 <i class="fas fa-arrow-right"></i></span>
                        </div>
                    </div>
                </div>

                <!-- 市場趨勢預覽 -->
                <div class="col-md-4 mb-3">
                    <div class="chart-preview-card" role="button" tabindex="0" aria-label="查看市場趨勢分佈詳情">
                        <div class="chart-preview-header">
                            <div class="chart-preview-icon chart-preview-icon-orange">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="chart-preview-title">
                                <h6>市場趨勢</h6>
                                <p class="chart-preview-subtitle">預期走向分佈</p>
                            </div>
                        </div>
                        <div class="chart-preview-body">
                            <canvas id="mini-trend-chart" width="300" height="150"></canvas>
                        </div>
                        <div class="chart-preview-footer">
                            <span class="chart-preview-link">查看完整分析 <i class="fas fa-arrow-right"></i></span>
                        </div>
                    </div>
                </div>

                <!-- 關鍵詞雲預覽 -->
                <div class="col-md-4 mb-3">
                    <div class="chart-preview-card" role="button" tabindex="0" aria-label="查看關鍵詞文字雲詳情">
                        <div class="chart-preview-header">
                            <div class="chart-preview-icon chart-preview-icon-purple">
                                <i class="fas fa-cloud"></i>
                            </div>
                            <div class="chart-preview-title">
                                <h6>關鍵詞雲</h6>
                                <p class="chart-preview-subtitle">詞頻視覺化</p>
                            </div>
                        </div>
                        <div class="chart-preview-body">
                            <div id="mini-cloud-preview" class="mini-cloud-container"></div>
                        </div>
                        <div class="chart-preview-footer">
                            <span class="chart-preview-link">查看完整分析 <i class="fas fa-arrow-right"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="section-divider data-dependent-section" style="display: none;"></div>

        <!-- 圖表切換按鈕 -->
        <section id="chart-toggle-section" class="text-center mb-3 animate__animated animate__fadeIn data-dependent-section" aria-label="圖表類型切換" style="display: none;">
            <div class="chart-toggle-btn-group" role="group" aria-label="圖表類型切換">
                <button id="showKeywordTrend" class="chart-toggle-btn active" aria-label="關鍵詞趨勢" aria-pressed="true">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i>
                    <span class="btn-text">關鍵詞趨勢</span>
                </button>
                <button id="showExpectedTrend" class="chart-toggle-btn" aria-label="市場趨勢" aria-pressed="false">
                    <i class="fas fa-chart-pie" aria-hidden="true"></i>
                    <span class="btn-text">市場趨勢</span>
                </button>
                <button id="showKeywordCloud" class="chart-toggle-btn" aria-label="關鍵詞雲" aria-pressed="false">
                    <i class="fas fa-cloud" aria-hidden="true"></i>
                    <span class="btn-text">關鍵詞雲</span>
                </button>
            </div>
        </section>


        <!-- 關鍵詞趨勢分析圖表容器 -->
        <section id="keywordTrendContainer" class="animate__animated animate__fadeIn data-dependent-section" role="region" aria-labelledby="keyword-trend-title" style="display: none;">
            <h2 id="keyword-trend-title"><i class="fas fa-chart-bar" aria-hidden="true"></i> 關鍵詞趨勢分析</h2>

            <!-- 檢視模式切換 -->
            <div class="text-center mb-3">
                <div class="btn-group trend-mode-toggle" role="group" aria-label="趨勢檢視模式切換">
                    <button type="button" id="single-month-mode" class="btn btn-outline-primary active" title="單月檢視">
                        <i class="fas fa-calendar-day"></i> 單月檢視
                    </button>
                    <button type="button" id="multi-month-mode" class="btn btn-outline-primary" title="多月比較">
                        <i class="fas fa-calendar-alt"></i> 多月比較
                    </button>
                    <button type="button" id="time-range-mode" class="btn btn-outline-primary" title="時間範圍分析">
                        <i class="fas fa-chart-line"></i> 時間範圍
                    </button>
                </div>
            </div>

            <!-- 單月選擇模式 -->
            <div id="single-month-controls" class="text-center mb-3">
                <label for="month-slider" class="form-label">選擇月份以查看趨勢變化：</label>
                <div class="d-flex align-items-center justify-content-center" role="group" aria-label="月份選擇控制項">
                    <button id="prev-month" class="btn btn-secondary" aria-label="上一個月"><i class="fas fa-chevron-left" aria-hidden="true"></i></button>
                    <input type="range" id="month-slider" class="mx-3" aria-label="選擇月份" aria-valuemin="0" aria-valuemax="12" aria-valuenow="0" aria-live="polite">
                    <button id="next-month" class="btn btn-secondary" aria-label="下一個月"><i class="fas fa-chevron-right" aria-hidden="true"></i></button>
                    <span id="selected-month" class="badge" role="status" aria-live="polite" aria-atomic="true"></span>
                </div>
            </div>

            <!-- 多月選擇模式 -->
            <div id="multi-month-controls" class="mb-3" style="display: none;">
                <label class="form-label text-center d-block">選擇要比較的月份（最多 5 個）：</label>
                <div id="month-checkboxes" class="month-checkbox-container"></div>
                <div class="text-center mt-2">
                    <button id="apply-multi-month" class="btn btn-primary btn-sm">
                        <i class="fas fa-chart-bar"></i> 套用比較
                    </button>
                    <button id="clear-month-selection" class="btn btn-secondary btn-sm">
                        <i class="fas fa-times"></i> 清除選擇
                    </button>
                </div>
            </div>

            <!-- 時間範圍選擇模式 -->
            <div id="time-range-controls" class="mb-3" style="display: none;">
                <div class="row justify-content-center">
                    <div class="col-md-4">
                        <label for="trend-start-month" class="form-label">起始月份：</label>
                        <select id="trend-start-month" class="form-control">
                            <option value="">請選擇...</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="trend-end-month" class="form-label">結束月份：</label>
                        <select id="trend-end-month" class="form-control">
                            <option value="">請選擇...</option>
                        </select>
                    </div>
                </div>
                <div class="text-center mt-2">
                    <button id="apply-time-range" class="btn btn-primary btn-sm">
                        <i class="fas fa-chart-line"></i> 套用範圍
                    </button>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="trend" width="600" height="400" role="img" aria-label="關鍵詞出現次數趨勢圖表"></canvas>
            </div>

            <!-- 圖表控制按鈕 -->
            <div class="text-center mt-3">
                <button id="reset-chart-zoom" class="btn btn-sm btn-outline-secondary" title="重置圖表縮放">
                    <i class="fas fa-search-minus"></i> 重置縮放
                </button>
            </div>

            <div class="text-muted text-center mt-3">
                <small id="trend-chart-description">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    <span id="trend-description-text">此圖表顯示選定月份中出現頻率最高的關鍵詞</span>
                </small>
            </div>
        </section>

        <!-- 每月預期市場趨勢分佈圖表容器 -->
        <section id="expectedTrendContainer" class="animate__animated animate__fadeIn data-dependent-section" role="region" aria-labelledby="expected-trend-title" style="display: none;">
            <h2 id="expected-trend-title"><i class="fas fa-chart-pie" aria-hidden="true"></i> 每月預期市場趨勢分佈</h2>

            <!-- 圖表類型切換 -->
            <div class="text-center mb-3">
                <div class="chart-type-toggle" role="group" aria-label="圖表類型切換">
                    <button type="button" class="chart-type-btn active" data-chart-type="bar" title="堆疊長條圖">
                        <i class="fas fa-chart-bar"></i> 長條圖
                    </button>
                    <button type="button" class="chart-type-btn" data-chart-type="line" title="折線圖">
                        <i class="fas fa-chart-line"></i> 折線圖
                    </button>
                    <button type="button" class="chart-type-btn" data-chart-type="area" title="堆疊面積圖">
                        <i class="fas fa-chart-area"></i> 面積圖
                    </button>
                    <button type="button" class="chart-type-btn" data-chart-type="percentage" title="百分比堆疊圖">
                        <i class="fas fa-percentage"></i> 百分比
                    </button>
                    <button type="button" class="chart-type-btn" data-chart-type="doughnut" title="甜甜圈圖">
                        <i class="fas fa-circle-notch"></i> 甜甜圈
                    </button>
                </div>
            </div>

            <!-- 甜甜圈圖月份滑桿 -->
            <div id="doughnut-month-controls" class="text-center mb-3" style="display: none;">
                <div class="doughnut-slider-container">
                    <button id="doughnut-prev-month" class="btn btn-sm btn-secondary" aria-label="上一個月">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="doughnut-slider-wrapper">
                        <input type="range" id="doughnut-month-slider" class="doughnut-slider" min="0" max="12" value="0" aria-label="選擇月份">
                        <div class="doughnut-slider-labels" id="doughnut-slider-labels"></div>
                    </div>
                    <button id="doughnut-next-month" class="btn btn-sm btn-secondary" aria-label="下一個月">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <span id="doughnut-selected-month" class="badge badge-primary ml-2"></span>
                </div>
                <div class="mt-2">
                    <button id="doughnut-show-all" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-layer-group"></i> 顯示全部月份
                    </button>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="expectedTrendChart" width="600" height="400" role="img" aria-label="每月預期市場趨勢分佈圖表"></canvas>
            </div>
            <div class="text-muted text-center mt-3">
                <small id="expected-trend-description"><i class="fas fa-info-circle" aria-hidden="true"></i> 此圖表顯示每月新聞中預期市場趨勢的分佈情況</small>
            </div>
        </section>

        <!-- 關鍵詞文字雲視覺化容器 -->
        <section id="keywordCloudContainer" class="animate__animated animate__fadeIn data-dependent-section" role="region" aria-labelledby="keyword-cloud-title" style="display: none;">
            <h2 id="keyword-cloud-title"><i class="fas fa-cloud" aria-hidden="true"></i> 關鍵詞文字雲視覺化</h2>
            <div class="cloud-controls text-center mb-3">
                <label for="cloud-size-slider" class="form-label">顯示關鍵詞數量：<span id="cloud-size-value">50</span></label>
                <input type="range" id="cloud-size-slider" class="form-range cloud-slider" min="20" max="100" step="10" value="50" aria-label="選擇顯示的關鍵詞數量">
            </div>
            <div class="wordcloud-container">
                <canvas id="keywordCloudCanvas" width="800" height="500" role="img" aria-label="關鍵詞文字雲視覺化圖表"></canvas>
            </div>
            <div class="text-muted text-center mt-3">
                <small><i class="fas fa-info-circle" aria-hidden="true"></i> 此文字雲顯示所有文章中出現頻率最高的關鍵詞，字體大小代表出現次數</small>
            </div>
        </section>

        <div class="section-divider data-dependent-section" style="display: none;"></div>

        <section id="filter-options" class="mb-4 animate__animated animate__fadeIn animate__delay-2s data-dependent-section" role="search" aria-labelledby="filter-heading" style="display: none;">
            <!-- 預設顯示區：快速選擇 + 排序 + 文章數 -->
            <div class="filter-compact-bar">
                <div class="filter-compact-left">
                    <div id="filter-result-count" class="badge badge-primary p-2" style="font-size: 0.9rem;">
                        <i class="fas fa-list"></i> 共 <span id="filtered-count">0</span> 篇
                    </div>
                    <button id="bookmark-filter-btn" class="btn btn-sm btn-outline-warning bookmark-filter-btn" title="顯示收藏的文章">
                        <i class="far fa-bookmark"></i>
                        <span class="bookmark-count-badge" id="bookmark-count-badge" style="display: none;">0</span>
                    </button>
                    <div class="quick-date-filters" role="group" aria-label="快速日期篩選">
                        <button type="button" class="btn btn-sm btn-outline-secondary quick-date-btn" data-range="last1Month" title="最近1個月">1個月</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary quick-date-btn" data-range="last3Months" title="最近3個月">3個月</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary quick-date-btn" data-range="last6Months" title="最近6個月">6個月</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary quick-date-btn" data-range="last1Year" title="最近1年">1年</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary quick-date-btn active" data-range="all" title="全部時間">全部</button>
                    </div>
                </div>
                <div class="filter-compact-right">
                    <div class="sort-controls-compact">
                        <select id="sort-field" class="form-control form-control-sm sort-field-select" aria-label="選擇排序欄位">
                            <option value="date" selected>時間</option>
                            <option value="title">標題</option>
                            <option value="publisher">來源</option>
                            <option value="keywords-count">關鍵詞數</option>
                            <option value="trend">預期走向</option>
                            <option value="relevance">相關性</option>
                        </select>
                        <button id="sort-direction-btn" class="btn btn-sm btn-outline-secondary sort-direction-btn" data-direction="desc" title="目前：新到舊" aria-label="切換排序方向">
                            <i class="fas fa-sort-amount-down"></i>
                        </button>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" type="button" data-toggle="collapse" data-target="#more-filters" aria-expanded="false" aria-controls="more-filters" title="更多篩選選項">
                        <i class="fas fa-sliders-h"></i> 更多
                    </button>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="匯出資料">
                            <i class="fas fa-download"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right">
                            <h6 class="dropdown-header"><i class="fas fa-file-alt"></i> 資料格式</h6>
                            <button id="export-csv-btn" class="dropdown-item" type="button">
                                <i class="fas fa-file-csv text-success"></i> CSV 格式
                            </button>
                            <button id="export-json-btn" class="dropdown-item" type="button">
                                <i class="fas fa-file-code text-info"></i> JSON 格式
                            </button>
                            <div class="dropdown-divider"></div>
                            <h6 class="dropdown-header"><i class="fas fa-chart-bar"></i> 圖表</h6>
                            <button id="export-chart-keyword-btn" class="dropdown-item" type="button">
                                <i class="fas fa-chart-line text-primary"></i> 關鍵詞趨勢圖
                            </button>
                            <button id="export-chart-trend-btn" class="dropdown-item" type="button">
                                <i class="fas fa-chart-pie text-warning"></i> 市場趨勢圖
                            </button>
                            <button id="export-chart-cloud-btn" class="dropdown-item" type="button">
                                <i class="fas fa-cloud text-secondary"></i> 文字雲圖
                            </button>
                            <div class="dropdown-divider"></div>
                            <button id="export-full-report-btn" class="dropdown-item font-weight-bold" type="button">
                                <i class="fas fa-file-download text-danger"></i> 完整報表
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 已選篩選條件標籤 -->
            <div class="active-filters-container mt-2" id="active-filters-container" style="display: none;">
                <div id="active-filters-tags" class="d-flex align-items-center gap-2 flex-wrap"></div>
                <button id="clear-all-filters-btn" class="clear-all-filters-btn" style="display: none;" title="清除所有篩選條件">
                    <i class="fas fa-times-circle"></i> 清除全部
                </button>
            </div>

            <!-- 展開區：更多篩選選項 -->
            <div class="collapse mt-3" id="more-filters">
                <div class="more-filters-panel">
                    <!-- 日期範圍 -->
                    <div class="filter-group">
                        <label class="filter-group-label"><i class="far fa-calendar-alt"></i> 日期範圍</label>
                        <div class="d-flex align-items-center gap-2">
                            <input type="date" id="start-date" class="form-control form-control-sm" aria-label="起始日期">
                            <span class="text-muted">~</span>
                            <input type="date" id="end-date" class="form-control form-control-sm" aria-label="結束日期">
                        </div>
                    </div>

                    <!-- 搜尋 -->
                    <div class="filter-group">
                        <label class="filter-group-label"><i class="fas fa-search"></i> 關鍵字搜尋</label>
                        <div class="search-container">
                            <div class="input-group input-group-sm">
                                <input type="text"
                                       id="keyword-filter"
                                       class="form-control search-input"
                                       placeholder="搜尋標題、內文、摘要或關鍵詞..."
                                       aria-label="搜尋文章"
                                       autocomplete="off">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary search-clear-btn"
                                            type="button"
                                            id="search-clear-btn"
                                            title="清除搜尋"
                                            style="display: none;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <button id="search-options-dropdown-btn"
                                            class="btn btn-outline-secondary dropdown-toggle search-options-btn"
                                            type="button"
                                            data-toggle="dropdown"
                                            aria-haspopup="true"
                                            aria-expanded="false"
                                            title="搜尋選項">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right search-options-dropdown">
                                        <h6 class="dropdown-header"><i class="fas fa-crosshairs"></i> 搜尋範圍</h6>
                                        <div class="px-3 py-2">
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input search-scope-option" id="search-scope-title" value="title" checked>
                                                <label class="custom-control-label" for="search-scope-title">標題</label>
                                            </div>
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input search-scope-option" id="search-scope-summary" value="summary" checked>
                                                <label class="custom-control-label" for="search-scope-summary">摘要</label>
                                            </div>
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input search-scope-option" id="search-scope-content" value="fullText" checked>
                                                <label class="custom-control-label" for="search-scope-content">內文</label>
                                            </div>
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input search-scope-option" id="search-scope-keywords" value="keywords" checked>
                                                <label class="custom-control-label" for="search-scope-keywords">關鍵詞</label>
                                            </div>
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        <h6 class="dropdown-header"><i class="fas fa-cog"></i> 搜尋選項</h6>
                                        <div class="px-3 py-2">
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" id="search-case-sensitive">
                                                <label class="custom-control-label" for="search-case-sensitive">區分大小寫</label>
                                            </div>
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" id="search-exact-match">
                                                <label class="custom-control-label" for="search-exact-match">完全符合</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 搜尋建議下拉選單 -->
                            <div class="search-suggestions" id="search-suggestions" style="display: none;">
                                <div class="search-suggestions-section" id="search-history-section" style="display: none;">
                                    <div class="search-suggestions-header">
                                        <span><i class="fas fa-history"></i> 最近搜尋</span>
                                        <button class="btn btn-sm btn-link search-clear-history" id="search-clear-history" title="清除歷史">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                    <div class="search-suggestions-list" id="search-history-list"></div>
                                </div>
                                <div class="search-suggestions-section" id="search-popular-section">
                                    <div class="search-suggestions-header">
                                        <span><i class="fas fa-fire"></i> 熱門關鍵詞</span>
                                    </div>
                                    <div class="search-suggestions-list" id="search-popular-list"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 新聞媒體篩選 -->
                    <div class="filter-group">
                        <label id="media-filter-label" class="filter-group-label"><i class="fas fa-newspaper"></i> 新聞媒體</label>
                        <div class="btn-group-toggle d-flex flex-wrap" data-toggle="buttons" role="group" aria-labelledby="media-filter-label">
                            <label class="btn btn-sm btn-outline-primary active m-1">
                                <input type="checkbox" class="media-filter" value="中國時報" checked id="media-filter-chinatimes">
                                中國時報
                            </label>
                            <label class="btn btn-sm btn-outline-primary active m-1">
                                <input type="checkbox" class="media-filter" value="聯合新聞網" checked id="media-filter-united-daily">
                                聯合新聞網
                            </label>
                            <label class="btn btn-sm btn-outline-primary active m-1">
                                <input type="checkbox" class="media-filter" value="工商時報" checked id="media-filter-commercial-times">
                                工商時報
                            </label>
                            <label class="btn btn-sm btn-outline-primary active m-1">
                                <input type="checkbox" class="media-filter" value="自由時報" checked id="media-filter-liberty-times">
                                自由時報
                            </label>
                            <label class="btn btn-sm btn-outline-primary active m-1">
                                <input type="checkbox" class="media-filter" value="風傳媒" checked id="media-filter-storm">
                                風傳媒
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <button id="toggle-news-button" class="btn btn-info mb-4 animate__animated animate__fadeIn animate__delay-3s data-dependent-section" aria-expanded="false" aria-controls="news-content" aria-label="顯示或隱藏新聞內容" style="display: none;">
            <i class="fas fa-newspaper" aria-hidden="true"></i> 顯示/隱藏新聞內容
        </button>

        <div id="news-content" class="collapse">
            <main id="main-content" role="main">
                <!-- 新聞列表標題與檢視模式切換 -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 id="articles-heading" class="mb-0"><i class="fas fa-list-alt" aria-hidden="true"></i> 新聞列表</h2>
                    <!-- 檢視模式切換按鈕 -->
                    <div class="btn-group" role="group" aria-label="檢視模式切換">
                        <button id="view-mode-card" class="btn btn-sm btn-outline-primary active" title="卡片檢視" aria-label="切換為卡片檢視">
                            <i class="fas fa-th-large"></i> 卡片
                        </button>
                        <button id="view-mode-list" class="btn btn-sm btn-outline-primary" title="列表檢視" aria-label="切換為列表檢視">
                            <i class="fas fa-list"></i> 列表
                        </button>
                    </div>
                </div>
                <div id="articles" class="row" role="feed" aria-labelledby="articles-heading" aria-busy="false"></div>

                <nav aria-label="頁面跳轉" id="pagination-options" class="mb-4 mt-4">
                    <div class="form-row align-items-end">
                        <div class="col-md-3">
                            <label for="jump-page"><i class="fas fa-file-alt" aria-hidden="true"></i> 跳轉至頁碼：</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="jump-page-icon"><i class="fas fa-hashtag" aria-hidden="true"></i></span>
                                </div>
                                <input type="number" id="jump-page" class="form-control" placeholder="輸入頁碼" min="1" aria-label="輸入要跳轉的頁碼" aria-describedby="jump-page-icon">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <button id="jump-button" class="btn btn-secondary btn-block" aria-label="跳轉到指定頁碼">
                                <i class="fas fa-arrow-right" aria-hidden="true"></i> 跳轉
                            </button>
                        </div>
                    </div>
                </nav>

                <nav class="pagination" id="pagination" aria-label="文章分頁導航"></nav>
            </main>
        </div>

        <footer role="contentinfo" class="mt-5 mb-3 text-center text-muted">
            <p><small>© 2025 房市新聞摘要與趨勢分析 | 資料僅供參考，不構成投資建議</small></p>
        </footer>
    </div>

    <!-- CSV上傳側邊欄 -->
    <div id="upload-sidebar" class="upload-sidebar" role="dialog" aria-labelledby="upload-sidebar-heading" aria-hidden="true">
        <div class="upload-sidebar-overlay"></div>
        <div class="upload-sidebar-content">
            <div class="upload-sidebar-header">
                <h5 id="upload-sidebar-heading"><i class="fas fa-cloud-upload-alt me-2"></i> 上傳CSV資料</h5>
                <button class="upload-sidebar-close" aria-label="關閉上傳側邊欄">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="upload-sidebar-body">
                <form id="csv-upload-form" aria-label="CSV檔案上傳表單">
                    <div class="form-group">
                        <label for="csv-file" class="font-weight-bold">選擇CSV檔案：</label>
                        <div class="custom-file mb-3">
                            <input type="file" class="custom-file-input" id="csv-file" accept=".csv" aria-describedby="csv-file-help" aria-required="true">
                            <label class="custom-file-label" for="csv-file">選擇檔案...</label>
                        </div>
                        <small id="csv-file-help" class="form-text text-muted"><i class="fas fa-info-circle" aria-hidden="true"></i> 請上傳包含新聞資料的CSV檔案。支援標題、摘要、關鍵詞、日期等欄位。檔案大小限制為1GB。</small>
                    </div>
                    <!-- 範例 CSV 區塊 -->
                    <div class="sample-csv-section mb-3">
                        <div class="sample-csv-header">
                            <i class="fas fa-file-csv"></i>
                            <span>範例檔案</span>
                        </div>
                        <p class="sample-csv-description">不確定格式？下載範例檔案查看，或直接載入測試資料體驗功能。</p>
                        <div class="sample-csv-buttons">
                            <a href="sample_data.csv" download="sample_data.csv" class="btn btn-outline-info btn-sm">
                                <i class="fas fa-download me-1"></i> 下載範例 CSV
                            </a>
                            <button type="button" id="load-sample-data-btn" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-play me-1"></i> 載入範例資料
                            </button>
                        </div>
                    </div>
                    <!-- 上傳進度條 -->
                    <div id="upload-progress-container" class="mb-3" style="display: none;">
                        <div class="progress" style="height: 25px;">
                            <div id="upload-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                <span id="upload-progress-text">0%</span>
                            </div>
                        </div>
                        <small id="upload-progress-message" class="text-muted"></small>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block" aria-label="上傳並處理CSV檔案"><i class="fas fa-cloud-upload-alt me-1" aria-hidden="true"></i> 上傳並處理</button>
                </form>
                <div id="upload-status" class="mt-3" role="status" aria-live="polite" aria-atomic="true"></div>
            </div>
        </div>
    </div>

    <!-- 改善的空狀態設計 -->
    <div id="empty-state" class="empty-state" style="display: none;">
        <div class="empty-state-content">
            <svg class="empty-state-icon" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <rect x="40" y="80" width="120" height="100" rx="8" fill="currentColor" opacity="0.1"/>
                <rect x="50" y="60" width="100" height="80" rx="8" fill="currentColor" opacity="0.2"/>
                <rect x="60" y="40" width="80" height="60" rx="8" fill="currentColor" opacity="0.3"/>
                <path d="M100 70 L100 90 M90 80 L110 80" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            </svg>
            <h3>歡迎使用房市趨勢分析工具</h3>
            <p class="empty-state-description">上傳CSV檔案開始分析台灣房地產市場趨勢</p>

            <ol class="onboarding-steps">
                <li>
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <strong>上傳CSV檔案</strong>
                        <span>包含新聞資料的CSV檔案</span>
                    </div>
                </li>
                <li>
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <strong>自動分析</strong>
                        <span>系統分析關鍵詞與市場趨勢</span>
                    </div>
                </li>
                <li>
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <strong>深入洞察</strong>
                        <span>使用圖表與篩選功能探索數據</span>
                    </div>
                </li>
            </ol>

            <button id="empty-state-upload-btn" class="btn btn-primary btn-lg">
                <i class="fas fa-cloud-upload-alt me-2"></i>上傳CSV檔案
            </button>
        </div>
    </div>

    <!-- 清除資料確認對話框 -->
    <div class="modal fade" id="clearDataModal" tabindex="-1" role="dialog" aria-labelledby="clearDataModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="clearDataModalLabel">
                        <i class="fas fa-exclamation-triangle"></i> 確認清除資料
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="關閉">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-trash-alt text-danger" style="font-size: 3rem;"></i>
                    </div>
                    <p class="text-center mb-2"><strong>您確定要清除所有資料嗎？</strong></p>
                    <p class="text-center text-muted mb-3">此操作將刪除 IndexedDB 中儲存的所有文章資料，且無法復原。</p>
                    <div class="alert alert-warning mb-0">
                        <i class="fas fa-info-circle"></i>
                        <small>清除後，您需要重新上傳 CSV 檔案才能使用應用程式。</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fas fa-times"></i> 取消
                    </button>
                    <button type="button" class="btn btn-danger" id="confirm-clear-data-btn">
                        <i class="fas fa-trash-alt"></i> 確認清除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入外部資源 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
    
    <!-- 引入模組化的 JavaScript 檔案 -->
    <script src="js/modules/Constants.js"></script>
    <script src="js/modules/Validator.js"></script>
    <script src="js/modules/SecurityUtils.js"></script>
    <script src="js/modules/ErrorHandler.js"></script>
    <script src="js/modules/Utilities.js"></script>
    <script src="js/modules/CacheManager.js"></script>
    <script src="js/modules/StateManager.js"></script>
    <script src="js/modules/AccessibilityManager.js"></script>
    <script src="js/modules/ExportManager.js"></script>
    <script src="js/modules/BookmarkManager.js"></script>
    <script src="js/modules/UIComponents.js"></script>
    <script src="js/modules/ChartManager.js"></script>
    <script src="js/modules/SearchManager.js"></script>
    <script src="js/modules/EventHandlers.js"></script>
    <script src="js/App.js"></script>
    
    <!-- 保留現有數據和上傳功能 -->
    <script src="data.js"></script>
    <script src="csv-uploader.js"></script>
    
    <!-- 引入 Bootstrap 所需的 JavaScript 和 Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
